<div class="p-4">
  <p-card *ngIf="funcionario" header="Editar Funcionário">
    <form [formGroup]="funcionarioForm" (ngSubmit)="saveFuncionario()">
      <div class="p-fluid">
        <div class="field">
          <label for="nome">Nome</label>
          <input id="nome" type="text" pInputText formControlName="nome" />
          <small *ngIf="funcionarioForm.get('nome')?.touched && funcionarioForm.get('nome')?.errors?.['required']" class="p-error">
            Nome é obrigatório.
          </small>
        </div>

        <div class="field">
          <label for="matricula">Matrícula</label>
          <input id="matricula" type="text" pInputText formControlName="matricula" />
          <small *ngIf="funcionarioForm.get('matricula')?.touched && funcionarioForm.get('matricula')?.errors?.['required']" class="p-error">
            Matrícula é obrigatória.
          </small>
        </div>

        <div class="field">
          <label for="telefone">Telefone</label>
          <input id="telefone" type="text" pInputText formControlName="telefone" />
          <small *ngIf="funcionarioForm.get('telefone')?.touched && funcionarioForm.get('telefone')?.errors?.['required']" class="p-error">
            Telefone é obrigatório.
          </small>
        </div>

        <div class="field">
          <label for="status">Status</label>
          <p-dropdown
            formControlName="status"
            [options]="['Ativo', 'Suspenso', 'Inativo']"
            placeholder="Selecione o status"
          ></p-dropdown>
          <small *ngIf="funcionarioForm.get('status')?.touched && funcionarioForm.get('status')?.errors?.['required']" class="p-error">
            Status é obrigatório.
          </small>
        </div>

        <h5>Documentos</h5>
        <div formArrayName="documentos">
          <div *ngFor="let doc of documentos.controls; let i = index" [formGroupName]="i" class="field mb-3 p-3 border-round border-1">
            <div class="field">
              <label [for]="'categoria' + i">Categoria</label>
              <p-dropdown
                [id]="'categoria' + i"
                formControlName="categoria"
                [options]="categoriasOptions"
                optionLabel="label"
                optionValue="value"
                placeholder="Selecione uma categoria"
              ></p-dropdown>
              <small *ngIf="doc.get('categoria')?.touched && doc.get('categoria')?.errors?.['required']" class="p-error">
                Categoria é obrigatória.
              </small>
            </div>

            <div class="field">
              <label [for]="'arquivo' + i">Arquivo</label>
              <input type="file" [id]="'arquivo' + i" (change)="onFileChange($event, i)" />
              <small *ngIf="doc.get('arquivo')?.touched && doc.get('arquivo')?.errors?.['required']" class="p-error">
                Arquivo é obrigatório.
              </small>
              <small *ngIf="doc.get('nomeArquivo')?.value" class="p-text-secondary">
                Arquivo atual: {{ doc.get('nomeArquivo')?.value }}
              </small>
            </div>

            <button pButton type="button" label="Remover Documento" icon="pi pi-trash" class="p-button-danger" (click)="removeDocumento(i)"></button>
          </div>
        </div>

        <button pButton type="button" label="Adicionar Documento" icon="pi pi-plus" class="p-button-secondary mb-3" (click)="addDocumento()"></button>
      </div>

      <div class="flex justify-content-between mt-3">
        <button pButton type="submit" label="Salvar" class="p-button-success" [disabled]="!funcionarioForm.valid"></button>
        <button pButton type="button" label="Excluir" class="p-button-danger" (click)="deleteFuncionario()"></button>
        <button pButton type="button" label="Voltar" class="p-button-secondary" (click)="goBack()"></button>
      </div>
    </form>
  </p-card>

  <div *ngIf="!funcionario && !errorMessage" class="flex justify-content-center">
    <p-progressSpinner></p-progressSpinner>
  </div>

  <p-message *ngIf="errorMessage" severity="error" [text]="errorMessage"></p-message>
</div>